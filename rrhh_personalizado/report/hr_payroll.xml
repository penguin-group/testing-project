<odoo>
    <data>
        <template id="rrhh_personalizado.custom_single_nomina">
            <t t-name="rrhh_payroll.report_nomina">
                <t t-foreach="docs" t-as="payslip">
                    <t t-call="web.basic_layout">
                        <div class="page">
                            <t t-call="rrhh_personalizado.custom_template_nomina">
                                <t t-set="o" t-value="payslip" />
                                <t t-set="verison" t-value="'ORIGINAL'" />
                            </t>
                            <div id="separador" style="height:220px"></div>
                            <t t-call="rrhh_personalizado.custom_template_nomina">
                                <t t-set="o" t-value="payslip" />
                                <t t-set="verison" t-value="'DUPLICADO'" />
                            </t>
                        </div>
                    </t>
                </t>
            </t>
        </template>
        <template id="rrhh_personalizado.custom_template_nomina">
            <style>
                table.lineas {
                margin-left:auto;
                margin-right:auto;
                }
                table.lineas tr,table.lineas td,table.lineas th{
                border:2px solid black;
                padding:3px;
                }
                #cabecera,#montos,#pie{
                font-size:12px;
                }
                table.aguinaldo {
                width:100%;
                text-align:left;
                margin-top:20px;
                margin-bottom:40px;
                }
                table.aguinaldo tr,table.aguinaldo td,table.aguinaldo th{
                border:2px solid black;
                padding:3px;
                }
            </style>
            <t t-if="not payslip['es_nomina_vacaciones']">
                <t t-if="'Aguinaldo' not in payslip['struct_id'].name">
                    <!-- <div style="float:left;width:50%;border-left:1px dashed gray;padding-right:15px;"> -->
                    <div id="cabecera" style="margin-top:50px;">
                        <table style="width:100%;border:1px solid white;border-collapse:separate;border-spacing:3px;">
                            <tr style="text-align:center;" id="titulo">
                                <td colspan="1">
                                    <img t-att-src="'/rrhh_personalizado/static/img/Logo_MTESS_2.png'" style=" width: 270px;height: 100px; position: right;"/>

                                </td>
                                <td colspan="3">
                                    <h4 style="text-weight:bold;">LIQUIDACIÓN DE SALARIO</h4>
                                    <p>Conforme al ART. 236 del C. del Trabajo</p>
                                </td>
                            </tr>
                        </table>
                        <table style="width:100%;border:1px solid white;border-collapse:separate;border-spacing:3px;">
                             <tr >
                                <td style="font-weight:bold;text-align:left;">
                                    Nro. Recibo:
                                </td>
                                <td style="text-align:left;">
                                    <t t-esc="payslip.id" />
                                </td>
                             </tr>
                            <tr id="razon_social">
                                
                                <td style="font-weight:bold;text-align:left;">
                                    Empleador:
                                </td>
                                <td style="text-align:left;">
                                    <t t-esc="payslip['contract_id'].company_id.name" />
                                </td>
                                <td style="font-weight:bold;text-align:left;">
                                    Nro Patronal:
                                </td>
                                <td style="font-weight:bold;text-align:left;">
                                    <t t-esc="payslip.company_id.nro_patronal" />
                                </td>
                            </tr>
                            <tr id="nombre_empleado">
                                <td style="font-weight:bold;text-align:left;">Empleado:</td>
                                <td style="text-align:left;width:45%">
                                    <t t-esc="payslip['employee_id'].name" />
                                </td>
                                <td style="font-weight:bold;text-align:left;">Periodo de Pago:</td>
                                <td style="text-align:left;">
                                    del
                                    <t t-esc="payslip['date_from'].day" />
                                    al
                                    <t t-esc="payslip['date_to'].day" />
                                    de
                                    <t t-esc="payslip['mes_correspondiente']" />
                                    de
                                    <t t-esc="payslip['date_to'].year" />
                                </td>
                               
                            </tr>
                           
                        </table>
                    </div>
                    <br />
                    <div id="montos">
                        <table class="lineas" style="width:100%;">
                            <tr>
                                <th rowspan="2" style="text-align:center;">Dias Trab.</th>
                                <th rowspan="2" style="text-align:center;">Salario Basico</th>
                                <th rowspan="2" style="text-align:center;">Sub Total</th>
                                <th rowspan="2" style="text-align:center;">Horas Extras</th>
                                <th rowspan="2" style="text-align:center;">Otros Recargos</th>
                                <th rowspan="2" style="text-align:center;">Vacaciones</th>
                                <th rowspan="2" style="text-align:center;">Bonific. Familiar</th>
                                <th rowspan="2" style="text-align:center;">Otros Ingresos</th>
                                <th rowspan="2" style="text-align:center;">Total Salario</th>
                                <th colspan="2" style="text-align:center;">Descuentos</th>
                                <th rowspan="2" style="text-align:center;">Total Descuent.</th>
                                <th rowspan="2" style="text-align:center;">Saldo a Cobrar</th>
                            </tr>
                            <tr>
                                <th style="text-align:center;">I.P.S.</th>
                                <th style="text-align:center;">Otros.</th>
                            </tr>
                            
                            <tr style="font-weight:bold;height: 60px;">
                                <td style="text-align:center;vertical-align: middle;">
                                    <!-- <t t-esc="sum([int(worked_day_line.number_of_days) if payslip['struct_id'].type_id.wage_type != 'hourly' else int(worked_day_line.number_of_days * 8 + worked_day_line.number_of_hours) for worked_day_line in payslip['worked_days_line_ids'].filtered(lambda x:x.code in ['WORK100'])]) - sum([int(worked_day_line.number_of_days) for worked_day_line in payslip['worked_days_line_ids'].filtered(lambda x:x.code in ['VAC'])])" /> -->
                                    <!-- <t t-set="dias_trabajados" t-value="sum([int(worked_day_line.number_of_days) if payslip['struct_id'].type_id.wage_type != 'hourly' else int(worked_day_line.number_of_days * 8 + worked_day_line.number_of_hours) for worked_day_line in payslip['worked_days_line_ids'].filtered(lambda x:x.code in ['WORK100'])])" />
                                    <t t-set="dias_vacaciones" t-value="sum([int(worked_day_line.number_of_days) for worked_day_line in payslip['worked_days_line_ids'].filtered(lambda x:x.code in ['VAC'])])" />
                                    <t t-set="dias_ausencias" t-value="sum([int(worked_day_line.number_of_days) for worked_day_line in payslip['worked_days_line_ids'].filtered(lambda x:x.code in ['AUS'])])" />
                                    <t t-esc="dias_trabajados - (dias_ausencias + dias_vacaciones)" /> -->
                                    <!-- <t t-esc="sum([int(worked_day_line.number_of_days) if payslip['struct_id'].type_id.wage_type != 'hourly' else int(worked_day_line.number_of_days * 8 + worked_day_line.number_of_hours) for worked_day_line in payslip['worked_days_line_ids'].filtered(lambda x:x.code in ['WORK100'])]) - sum([int(worked_day_line.number_of_days) for worked_day_line in payslip['worked_days_line_ids'].filtered(lambda x:x.code in ['VAC'])])" /> -->
                                    <!-- lineas Agregados por Edgar Gonzalez -->
                                    <!-- <t t-esc="','.join(str(int(worked_day_line.number_of_days)) for worked_day_line in payslip['worked_days_line_ids'].filtered(lambda x: x.code in ['WORK100']))" /> -->
                                    <!-- <t t-set="cantidad_SAL" t-value="sum([int(line_ids.quantity)  for line_ids in payslip['line_ids'].filtered(lambda x:x.code in ['SAL'])])" />
                                    <t t-esc="cantidad_SAL" />
                                    <t t-set="cantidad_REP" t-value="round((sum([int(line_ids.quantity)  for line_ids in payslip['line_ids'].filtered(lambda x:x.code in ['REP'])]))/8)" />
                                    <t t-esc="cantidad_REP" />
                                    <t t-esc="'{0:,}'.format(cantidad_SAL - cantidad_REP).replace(',', '.')" /> -->
                                    <t t-set="cantidad_sal" t-value="sum([int(worked_day_line.number_of_days) for worked_day_line in payslip['worked_days_line_ids'].filtered(lambda x:x.code in ['WORK100'])])" />
                                    <!-- <t t-esc="cantidad_sal" /> -->
                                    
                                    <t t-set="dias_vacaciones" t-value="sum([int(worked_day_line.number_of_days) for worked_day_line in payslip['worked_days_line_ids'].filtered(lambda x:x.code in ['VAC'])])" />
                                    <!-- <t t-esc="dias_vacaciones" /> -->
                                    <t t-set="dias_ausencias" t-value="((sum([int(worked_day_line.number_of_days) for worked_day_line in payslip['worked_days_line_ids'].filtered(lambda x:x.code in ['AUS'])])/8)-dias_vacaciones)" />
                                    <!-- <t t-esc="dias_ausencias" /> -->
                                    <t t-esc="round(cantidad_sal - dias_ausencias)" />

                                </td>
                                <td style="text-align:right;vertical-align: middle;">
                                    <!-- salario basico -->
                                    <!-- (line_ids.total)  for line_ids in payslip['line_ids'].filtered(lambda x:x.code in ['SAL']) -->
                                    <t t-esc=" '{0:,}'.format(round(sum([(line_ids.total)  for line_ids in payslip['line_ids'].filtered(lambda x:x.code in ['BASIC'])]))).replace(',', '.')" />
                                </td>
                                <td style="text-align:right;vertical-align: middle;">
                                    <!-- sub total -->
                                    <!-- <t t-esc="'{0:,}'.format(round(sum(payslip['line_ids'].filtered(lambda x:x.category_id.code in ['BASIC','ALW','HEX50','HEX100','HORAD']).mapped('amount')))).replace(',', '.')" /> -->

                                    <t t-set="total_dias_trabajados" t-value=" sum([int(line_ids.total)  for line_ids in payslip['line_ids'].filtered(lambda x:x.code in ['BASIC'])])" />
                                    <t t-set="total_dias_vacaciones" t-value=" sum([int(line_ids.total)  for line_ids in payslip['line_ids'].filtered(lambda x:x.code in ['VAC'])])" />
                                    <t t-set="subtotal" t-value="(total_dias_trabajados - total_dias_vacaciones)" />
                                    <!-- <t t-esc="total_dias_trabajados" />
                                    <t t-esc="total_dias_vacaciones" /> -->

                                    <t t-esc="'{0:,}'.format(total_dias_trabajados - total_dias_vacaciones).replace(',', '.')" />
                                </td>
                                <td style="text-align:right;vertical-align: middle;">
                                    <!-- horas extra -->
                                    <t t-esc="'{0:,}'.format(round(sum(payslip['line_ids'].filtered(lambda x:x.code in ['HEX50']).mapped('total')))).replace(',', '.')" />
                                </td>
                                 <td style="text-align:right;vertical-align: middle;">
                                    <!-- otros recargos-->
                                    <t t-esc="'{0:,}'.format(round(sum(payslip['line_ids'].filtered(lambda x:x.code in ['HEX100','HNOC','RECN','EXT']).mapped('total')))).replace(',', '.')" />
                                </td>
                                 <td style="text-align:right;vertical-align: middle;">
                                    <!-- vacaciones-->
                                    <t t-esc="'{0:,}'.format(round(sum(payslip['line_ids'].filtered(lambda x:x.code in ['VAC']).mapped('total')))).replace(',', '.')" />
                                </td>
                                <td style="text-align:right;vertical-align: middle;">
                                    <!-- bonificacion familiar -->
                                    <t t-esc="'{0:,}'.format(round(sum(payslip['line_ids'].filtered(lambda x:x.code in ['BF']).mapped('total')))).replace(',', '.')" />
                                </td>
                                 <td style="text-align:right;vertical-align: middle;">
                                    <!-- otros ingresos dfdfdfdfdf--> 
                                    <t t-esc="'{0:,}'.format(round(sum(payslip['line_ids'].filtered(lambda x:x.code in ['EXT']).mapped('total')))).replace(',', '.')" />
                                </td>
                                <td style="text-align:right;vertical-align: middle;">
                                    <!-- salario total -->
                                    <t t-esc="'{0:,}'.format(round(sum(payslip['line_ids'].filtered(lambda x:x.code in ['GROSS']).mapped('total')))).replace(',', '.')" />
                                    <t t-set="salario_total" t-value="sum(payslip['line_ids'].filtered(lambda x:x.code in ['GROSS']).mapped('total'))" />

                                </td>
                                <td style="text-align:right;vertical-align: middle;">
                                    <!-- IPS -->
                                    <!-- <t t-set="vaca_ips" t-value="(int(total_dias_vacaciones) * (0.09))" /> -->
                                     <!-- <t t-esc="total_dias_vacaciones" /> -->
                                    <t t-esc="'{0:,}'.format(round(sum(payslip['line_ids'].filtered(lambda x:x.code in ['IPS']).mapped('total')))).replace(',', '.')" />
                                    <t t-set="campo_ips" t-value="(sum(payslip['line_ids'].filtered(lambda x:x.code in ['IPS']).mapped('total')))" />

                                </td>
                                <td style="text-align:right;vertical-align: middle;">
                                    <!-- otros -->
                                    <t t-esc="'{0:,}'.format(round(sum(payslip['line_ids'].filtered(lambda x:x.code in ['OD','ANTS','DESCC']).mapped('total')))).replace(',', '.')" />
                                    <t t-set="campo_otros" t-value="(sum(payslip['line_ids'].filtered(lambda x:x.code in ['OD','ANTS','DESCC']).mapped('total')))" />

                                </td>
                                <td style="text-align:right;vertical-align: middle;">
                                    <!-- total a descontar -->
                                    <t t-set="total_descontar" t-value="campo_ips + campo_otros" />
                                    <t t-esc="'{0:,}'.format(round(campo_ips + campo_otros)).replace(',', '.')" />
                                </td>
                                <td style="text-align:right;vertical-align: middle;">
                                    <!-- saldo a cobrar -->
                                    <t t-esc="'{0:,}'.format(round(sum(payslip['line_ids'].filtered(lambda x:x.category_id.code in ['NET']).mapped('amount')))).replace(',', '.')" />

                                </td>
                            </tr>
                           
                        </table>
                    </div>
                    <br />
                    <div id="pie">
                        
                        <br />
                        <br />
                        <br />
                        <table style="width:100%;border:1px solid white;border-collapse:separate;border-spacing:3px;text-align:center;">
                            <tr style=" border: none;">
                                <td>
                                    ___________________________
                                    <br />
                                    Firma Empleador
                                    <br />
                                    <t t-esc="payslip['contract_id'].company_id.name" />
                                </td>
                                <td style="width:50%;">
                                    Fecha:
                                    <strong t-esc="payslip['date_to'].strftime('%d/%m/%Y')" />
                                </td>
                                <td>
                                    ___________________________
                                    <br />
                                    Firma Empleado
                                    <br />
                                    <t t-esc="payslip['employee_id'].name" />
                                </td>
                            </tr>
                        </table>
                    </div>
                </t>
                <t t-else="">
                    <div style="float:left;width:50%;border-left:1px dashed gray;padding:15px;">
                        <div style="border:1px solid gray;padding:10px;">

                            <table style="width:100%;text-align:right;">
                                <tr>
                                    <td>Empleador:</td>
                                    <td style="font-weight:bold;padding-left:10px;text-align:left;" t-esc="payslip['contract_id'].company_id.name" />
                                </tr>
                                <tr>
                                    <td>Registro Patronal Nro.:</td>
                                    <td style="font-weight:bold;padding-left:10px;text-align:left;" t-esc="payslip['contract_id'].patronal_mtess_id.number if payslip['contract_id'].patronal_mtess_id else ''" />
                                </tr>
                                <tr>
                                    <td>Empleado:</td>
                                    <td style="font-weight:bold;padding-left:10px;text-align:left;" t-esc="payslip['employee_id'].name" />
                                </tr>
                            </table>
                            <table class="aguinaldo">
                                <tr>
                                    <th>CONCEPTO</th>
                                    <th>MONTO</th>
                                </tr>
                                <tr height="50px">
                                    <td>
                                        <b>Aguinaldo</b>
                                        correspondiente al año
                                        <t t-esc="payslip['date_to'].year" />
                                    </td>
                                    <td style="text-align:right;font-weight:bold;">
                                        <t t-esc="'{0:,}'.format(round(sum(payslip['line_ids'].filtered(lambda x:x.category_id.code in ['NET']).mapped('amount')))).replace(',', '.')" />
                                    </td>
                                </tr>
                                <tr height="50px">
                                    <td colspan="2">
                                        Son Guaraníes:
                                        <b>
                                            <t t-esc="payslip['total_neto_letras'].upper()" />
                                        </b>
                                    </td>
                                </tr>
                                <tr>
                                    <td colspan="2">
                                        Fecha de pago:
                                        <span style="color:white;border-bottom: 1px solid black;">REY</span>
                                        /
                                        <span style="color:white;border-bottom: 1px solid black;">AYA</span>
                                        /
                                        <span style="color:white;border-bottom: 1px solid black;">NAMI</span>
                                    </td>
                                </tr>
                            </table>
                            <span>
                                Recibí conforme de
                                <t t-esc="payslip['company_id'].nombre + ' ' + (payslip['company_id'].apellido or '')" />
                                la liquidación que antecede, con firma del empleador.
                            </span>
                            <table style="width:100%;text-align:center;margin-top:80px;">
                                <tr>
                                    <td>
                                        ___________________________
                                        <br />
                                        Firma Empleador
                                        <br />
                                        <t t-esc="payslip['contract_id'].company_id.name" />
                                        <br />
                                        C.I.N.:
                                        <t t-esc="payslip['company_id'].vat.split('-')[0] if payslip['company_id'].vat else ''" />
                                    </td>
                                    <td>
                                        ___________________________
                                        <br />
                                        Firma Empleado
                                        <br />
                                        <t t-esc="payslip['employee_id'].name" />
                                        <br />
                                        C.I.N.:
                                        <t t-esc="payslip['employee_id'].identification_id.split('-')[0] if payslip['employee_id'].identification_id else ''" />
                                    </td>
                                </tr>
                            </table>

                        </div>
                    </div>
                </t>
            </t>
            <t t-else="">
                <h3 id="nomina_vacaciones" style="text-decoration:underline;text-weight:bold;">El recibo de salarios
                    para vacaciones, debe ser impreso desde la notifación de vacaciones
                </h3>
            </t>
            <br />
            <br />
        </template>

        <record model="report.paperformat" id="custom_papel_recibos">
            <field name="name">Custom Recibo</field>
            <field name="format">A4</field>
            <field name="orientation">Portrait</field>
            <field name="margin_top">5</field>
            <field name="margin_left">5</field>
            <field name="margin_right">5</field>
            <field name="margin_bottom">5</field>
            <field name="header_line" eval="False" />
            <field name="header_spacing">0</field>
            <field name="dpi">90</field>
        </record>
        <record model="ir.actions.report" id="rrhh_personalizado.recibo_custom">
            <field name="report_name">rrhh_personalizado.custom_single_nomina</field>
            <field name="name">Recibo</field>
            <field name="model">hr.payslip</field>
            <field name="paperformat_id" ref="rrhh_personalizado.custom_papel_recibos" />
            <field name="report_type">qweb-pdf</field>
        </record>
    </data>
</odoo>
