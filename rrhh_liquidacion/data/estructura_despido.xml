<?xml version="1.0" encoding="UTF-8" ?>
<odoo>
    <data>
        <record model="hr.payroll.structure.type" id="tipo_estructura_despido">
            <field name="name">Despido</field>
            <field name="country_id" ref="base.py"/>
            <field name="wage_type">monthly</field>
            <field name="default_schedule_pay">monthly</field>
            <field name="structure_type_tag">liquidacion</field>
        </record>

        <record model="hr.payroll.structure" id="estructura_despido">
            <field name="name">Plantilla - Estructura Despido</field>
            <field name="use_worked_day_lines" eval="False"/>
            <field name="schedule_pay">monthly</field>
            <field name="type_id" ref="rrhh_liquidacion.tipo_estructura_despido"/>
        </record>

        <record model="hr.salary.rule" id="regla_despido_basico">
            <field name="code">BASIC</field>
            <field name="name">Días Trabajados</field>
            <field name="category_id" ref="hr_payroll.BASIC"/>
            <field name="sequence">1000</field>
            <field name="appears_on_payslip" eval="False"/>
            <field name="struct_id" ref="rrhh_liquidacion.estructura_despido"/>
            <field name="amount_select">code</field>
            <field name="amount_python_compute">result = 0</field>
        </record>
        <record model="hr.salary.rule" id="regla_despido_salario_dias_trabajados">
            <field name="code">DTRAB</field>
            <field name="name">Salario por Días Trabajados</field>
            <field name="category_id" ref="hr_payroll.BASIC"/>
            <field name="sequence">1001</field>
            <field name="struct_id" ref="rrhh_liquidacion.estructura_despido"/>
            <field name="amount_select">code</field>
            <field name="amount_python_compute">result = inputs.DTRAB.amount if inputs.DTRAB else 0</field>
        </record>
        <record model="hr.salary.rule" id="regla_despido_bonificacion_familiar">
            <field name="name">Bonificación Familiar</field>
            <field name="category_id" ref="hr_payroll.ALW"/>
            <field name="code">BF</field>
            <field name="sequence">1002</field>
            <field name="struct_id" ref="rrhh_liquidacion.estructura_despido"/>
            <field name="amount_select">code</field>
            <field name="amount_python_compute"><![CDATA[
result_qty = employee.underage_children_count
result_rate = 5
result = payslip.env['wizard_salario_minimo'].get_salario_vigente(payslip.date_from)
            ]]></field>
        </record>
        <record model="hr.salary.rule" id="regla_despido_indemnizacion">
            <field name="code">INDEM</field>
            <field name="name">Indemnización</field>
            <field name="category_id" ref="hr_payroll.BASIC"/>
            <field name="sequence">1003</field>
            <field name="struct_id" ref="rrhh_liquidacion.estructura_despido"/>
            <field name="amount_select">code</field>
            <field name="amount_python_compute">result = inputs.INDEM.amount if inputs.INDEM else 0</field>
        </record>
        <record model="hr.salary.rule" id="regla_despido_vac_causadas">
            <field name="code">VACCAU</field>
            <field name="name">Vacaciones Causadas</field>
            <field name="category_id" ref="hr_payroll.BASIC"/>
            <field name="sequence">1004</field>
            <field name="struct_id" ref="rrhh_liquidacion.estructura_despido"/>
            <field name="amount_select">code</field>
            <field name="amount_python_compute">result = inputs.VACCAU.amount if inputs.VACCAU else 0</field>
        </record>
        <record model="hr.salary.rule" id="regla_despido_vac_proporcionales">
            <field name="code">VACPRO</field>
            <field name="name">Vacaciones Proporcionales</field>
            <field name="category_id" ref="hr_payroll.BASIC"/>
            <field name="sequence">1005</field>
            <field name="struct_id" ref="rrhh_liquidacion.estructura_despido"/>
            <field name="amount_select">code</field>
            <field name="amount_python_compute">result = inputs.VACPRO.amount if inputs.VACPRO else 0</field>
        </record>
        <record model="hr.salary.rule" id="regla_despido_vac_acumuladas">
            <field name="code">VACACU</field>
            <field name="name">Vacaciones Acumuladas</field>
            <field name="category_id" ref="hr_payroll.BASIC"/>
            <field name="sequence">1006</field>
            <field name="struct_id" ref="rrhh_liquidacion.estructura_despido"/>
            <field name="amount_select">code</field>
            <field name="amount_python_compute">result = inputs.VACACU.amount if inputs.VACACU else 0</field>
        </record>
        <record model="hr.salary.rule" id="regla_despido_otros_haberes">
            <field name="code">OTRH</field>
            <field name="name">Otros Haberes</field>
            <field name="category_id" ref="hr_payroll.BASIC"/>
            <field name="sequence">1008</field>
            <field name="struct_id" ref="rrhh_liquidacion.estructura_despido"/>
            <field name="amount_select">code</field>
            <field name="amount_python_compute">result = inputs.OTRH.amount if inputs.OTRH else 0</field>
        </record>
        <record model="hr.salary.rule" id="regla_despido_preaviso">
            <field name="code">PREAVdes</field>
            <field name="name">Preaviso</field>
            <field name="category_id" ref="hr_payroll.BASIC"/>
            <field name="sequence">1030</field>
            <field name="struct_id" ref="rrhh_liquidacion.estructura_despido"/>
            <field name="amount_select">code</field>
            <field name="amount_python_compute">result = inputs.PREAV.amount if inputs.PREAV else 0</field>
        </record>
        <record model="hr.salary.rule" id="regla_despido_otros_deberes">
            <field name="code">OTRD</field>
            <field name="name">Otros Deberes</field>
            <field name="category_id" ref="hr_payroll.DED"/>
            <field name="sequence">1009</field>
            <field name="struct_id" ref="rrhh_liquidacion.estructura_despido"/>
            <field name="amount_select">code</field>
            <field name="amount_python_compute">result = inputs.OTRD.amount if inputs.OTRD else 0</field>
        </record>
        <record model="hr.salary.rule" id="regla_despido_gross">
            <field name="code">GROSS</field>
            <field name="name">Liquidación Bruta</field>
            <field name="category_id" ref="hr_payroll.GROSS"/>
            <field name="sequence">1100</field>
            <field name="struct_id" ref="rrhh_liquidacion.estructura_despido"/>
            <field name="amount_select">code</field>
            <field name="amount_python_compute">result = categories.BASIC + categories.ALW</field>
        </record>
        <record model="hr.salary.rule" id="regla_despido_aguinaldo">
            <field name="code">AGUIPR</field>
            <field name="name">Aguinaldo Proporcional</field>
            <field name="category_id" ref="hr_payroll.BASIC"/>
            <field name="sequence">1105</field>
            <field name="struct_id" ref="rrhh_liquidacion.estructura_despido"/>
            <field name="amount_select">code</field>
            <field name="amount_python_compute"><![CDATA[
result = inputs.AGUIPR.amount if inputs.AGUIPR else 0
este_mes = categories.GROSS
este_mes -= inputs.DTRAB.amount if inputs.DTRAB else 0
este_mes -= inputs.VACCAU.amount if inputs.VACCAU else 0
este_mes -= inputs.VACPRO.amount if inputs.VACPRO else 0
este_mes -= inputs.VACACU.amount if inputs.VACACU else 0
este_mes -= inputs.INDEM.amount if inputs.INDEM else 0
este_mes -= inputs.PREAV.amount if inputs.PREAV else 0
result += este_mes / 12
            ]]></field>
        </record>
        <record model="hr.salary.rule" id="regla_despido_ips">
            <field name="code">IPS</field>
            <field name="name">Descuento por IPS</field>
            <field name="category_id" ref="hr_payroll.DED"/>
            <field name="sequence">1110</field>
            <field name="struct_id" ref="rrhh_liquidacion.estructura_despido"/>
            <field name="amount_select">code</field>
            <field name="amount_python_compute">result = (categories.GROSS - categories.DED) / 100 * 9</field>
        </record>
        <record model="hr.salary.rule" id="regla_despido_otros_deberes">
            <field name="code">OTRD</field>
            <field name="name">Otros Deberes</field>
            <field name="category_id" ref="hr_payroll.DED"/>
            <field name="sequence">1120</field>
            <field name="struct_id" ref="rrhh_liquidacion.estructura_despido"/>
            <field name="amount_select">code</field>
            <field name="amount_python_compute">result = inputs.OTRD.amount if inputs.OTRD else 0</field>
        </record>
        <!--        <record model="hr.salary.rule" id="regla_despido_amh">-->
        <!--            <field name="active" eval="False"/>-->
        <!--            <field name="code">AMH</field>-->
        <!--            <field name="name">Descuento por AMH</field>-->
        <!--            <field name="category_id" ref="hr_payroll.DED"/>-->
        <!--            <field name="sequence">1202</field>-->
        <!--            <field name="struct_id" ref="rrhh_liquidacion.estructura_despido"/>-->
        <!--            <field name="amount_select">code</field>-->
        <!--            <field name="amount_python_compute">result = inputs.AMH.amount if inputs.AMH else 0</field>-->
        <!--        </record>-->
        <record model="hr.salary.rule" id="regla_despido_net_beta">
            <field name="code">NETbeta</field>
            <field name="name">Liquidación Neta sin Aguinaldo</field>
            <field name="category_id" ref="hr_payroll.NET"/>
            <field name="sequence">1299</field>
            <field name="struct_id" ref="rrhh_liquidacion.estructura_despido"/>
            <field name="amount_select">code</field>
            <field name="amount_python_compute"><![CDATA[
aguinaldo = inputs.AGUIPR.amount if inputs.AGUIPR else 0
este_mes = categories.GROSS
este_mes -= inputs.VACCAU.amount if inputs.VACCAU else 0
este_mes -= inputs.VACPRO.amount if inputs.VACPRO else 0
este_mes -= inputs.VACACU.amount if inputs.VACACU else 0
aguinaldo += este_mes / 12

result = categories.BASIC + categories.ALW - categories.DED - aguinaldo
#result += aguinaldo
            ]]></field>
        </record>
        <record model="hr.salary.rule" id="regla_despido_net">
            <field name="code">NET</field>
            <field name="name">Liquidación Neta</field>
            <field name="category_id" ref="hr_payroll.NET"/>
            <field name="sequence">1300</field>
            <field name="struct_id" ref="rrhh_liquidacion.estructura_despido"/>
            <field name="amount_select">code</field>
            <field name="amount_python_compute"><![CDATA[
aguinaldo = inputs.AGUIPR.amount if inputs.AGUIPR else 0
este_mes = categories.GROSS
este_mes -= inputs.VACCAU.amount if inputs.VACCAU else 0
este_mes -= inputs.VACPRO.amount if inputs.VACPRO else 0
este_mes -= inputs.VACACU.amount if inputs.VACACU else 0
aguinaldo += este_mes / 12

result = categories.BASIC + categories.ALW - categories.DED - aguinaldo
if result < 0:
    result = aguinaldo
else:
    result += aguinaldo
            ]]></field>
        </record>
    </data>
</odoo>