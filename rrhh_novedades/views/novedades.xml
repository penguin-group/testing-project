<?xml version="1.0" encoding="utf-8"?>
<odoo>
    <!-- hr.novedades.tipo -->
    <data>
        <record id="hr_novedades_tipo_view_tree" model="ir.ui.view">
            <field name="name">hr_novedades_tipo_view_tree</field>
            <field name="model">hr.novedades.tipo</field>
            <field name="arch" type="xml">
                <tree>
                    <field name="name"/>
                    <field name="desembolso"/>
                    <field name="requiere_confirmacion"/>
                </tree></field>
        </record>
        <record id="hr_novedades_tipo_view_form" model="ir.ui.view">
            <field name="name">hr_novedades_tipo_view_form</field>
            <field name="model">hr.novedades.tipo</field>
            <field name="arch" type="xml">
                <form>
                    <sheet>
                        <group>
                            <group>
                                <field name="name" required="True"/>
                                <field invisible="tipo_novedad_adelanto_aguinaldo == True" name="periodicidad"/>
                                <field invisible="periodicidad != 'periodico'" name="periodicidad_periodo"/>
                                <field invisible="periodicidad != 'periodico'" name="tipo_cuota" required="periodicidad == 'periodico'"/>
                                <field name="code"/>
                                <field invisible="tipo_novedad_adelanto_aguinaldo == True" name="interes"/>
                                <field name="desembolso"/>
                                <field invisible="desembolso == False" name="account_account_desembolso_id" required="desembolso == True"/>
                                <field invisible="desembolso == False" name="account_journal_dest_desembolso_id"/>
                                <field name="requiere_confirmacion"/>
                                <field name="tipo_novedad_adelanto_aguinaldo"/>
                            </group>
                        </group>
                    </sheet>
                </form></field>
        </record>
        <record id="novedades_tipo_act_window" model="ir.actions.act_window">
            <field name="name">Tipos de Novedades</field>
            <field name="type">ir.actions.act_window</field>
            <field name="res_model">hr.novedades.tipo</field>
            <field name="view_mode">tree,form</field>
        </record>
        <menuitem action="novedades_tipo_act_window" id="menu_novedades_tipo" name="Tipos de Novedades" parent="hr_payroll.menu_hr_salary_configuration" sequence="33"/>
    </data>
    <!-- hr.novedades -->
    <data>
        <record id="novedades_tree_view" model="ir.ui.view">
            <field name="name">novedades_tree_view</field>
            <field name="model">hr.novedades</field>
            <field name="arch" type="xml">
                <tree>
                    <header>
                        <button name="button_create_account_payment" string="Desembolsar pago" type="object"/>
                    </header>
                    <field name="tipo_id"/>
                    <field name="fecha"/>
                    <field name="name"/>
                    <field name="employee_id"/>
                    <field name="contract_id"/>
                    <field name="amount_to_show"/>
                    <field name="monto" optional="hide" sum="Total"/>
                    <field name="state"/>
                </tree></field>
        </record>
        <record id="novedades_form_view" model="ir.ui.view">
            <field name="name">novedades_form_view</field>
            <field name="model">hr.novedades</field>
            <field name="arch" type="xml">
                <form>
                    <header>
                        <field invisible="True" name="desbloquear_monto"/>
                        <field name="state" widget="statusbar"/>
                        <button class="oe_highlight" invisible="state != 'draft'" name="button_confirmar" string="Confirmar" type="object"/>
                        <button invisible="state != 'done'" name="button_cancelar" string="Cancelar" type="object"/>
                        <button invisible="state != 'cancel'" name="button_draft" string="Cambiar a borrador" type="object"/>
                        <button invisible="state != 'draft' or periodicidad != 'periodico' or (periodicidad == 'periodico' and desbloquear_monto == True)" name="button_desbloquear_monto" string="Desbloquear monto" type="object"/>
                        <button invisible="desembolso == False or state not in ['done', 'procesado'] or payment_id != False or nro_cuota > 1" name="button_create_account_payment" string="Desembolsar pago" type="object"/>
                    </header>
                    <sheet>
                        <div class="oe_button_box" name="button_box">
                            <button class="oe_stat_button" groups="account.group_account_readonly" invisible="payment_id == False" name="action_show_account_payment" type="object">
                                <div aria-label="Off Till" class="fa fa-fw fa-money o_button_icon text-success" role="img" title="Ver Pago"/>
                                <div class="o_field_widget o_stat_info">
                                    <span class="o_stat_text">
                                        Ver Pago
                                    </span>
                                </div>
                            </button>
                        </div>
                        <widget bg_color="bg-success" invisible="payment_id == False" name="web_ribbon" title="Pago Creado"/>
                        <div class="oe_title">
                            <h1>
                                <field name="name" readonly="True"/>
                            </h1>
                        </div>
                        <group>
                            <group>
                                <field name="tipo_id" readonly="state != 'draft'" required="True" widget="selection"/>
                                <field invisible="True" name="payment_id"/>
                                <field invisible="True" name="desembolso"/>
                                <field invisible="True" name="periodicidad"/>
                                <field invisible="True" name="tipo_cuota"/>
                                <field invisible="True" name="es_cuota"/>
                                <field name="fecha" readonly="state != 'draft'"/>
                                <field invisible="desembolso == False or (desembolso == True and nro_cuota > 1)" name="fecha_desembolso" readonly="state != 'draft'" required="desembolso == True and nro_cuota == 1"/>
                                <field name="employee_id" readonly="state != 'draft'"/>
                                <field domain="[('employee_id','=',employee_id),('state','=','open')]" name="contract_id" readonly="state != 'draft' or employee_id == False"/>
                                <field invisible="True" name="readonly_monto"/>
                                <field name="monto" readonly="readonly_monto == True"/>
                                <field invisible="periodicidad != 'periodico' or (periodicidad == 'periodico' and tipo_cuota != 'monto_fijo')" name="monto_total" readonly="state != 'draft'" required="periodicidad == 'periodico'"/>
                                <field invisible="periodicidad != 'periodico' or (periodicidad == 'periodico' and tipo_cuota != 'porcentaje_sobre_bruto')" name="monto_objetivo" readonly="state != 'draft'" required="periodicidad == 'periodico'"/>
                                <field invisible="periodicidad != 'periodico' or (periodicidad == 'periodico' and tipo_cuota != 'porcentaje_sobre_bruto')" name="monto_amortizado" readonly="state != 'draft'" required="periodicidad == 'periodico'"/>
                                <field invisible="periodicidad != 'periodico' or (periodicidad == 'periodico' and tipo_cuota != 'porcentaje_sobre_bruto')" name="porcentaje_a_descontar" readonly="state != 'draft'" required="periodicidad == 'periodico' and tipo_cuota == 'porcentaje_sobre_bruto'"/>
                                <field invisible="periodicidad != 'periodico'" name="fecha_inicio" readonly="state != 'draft'" required="periodicidad == 'periodico'"/>
                                <field invisible="periodicidad != 'periodico' or (periodicidad == 'periodico' and tipo_cuota != 'monto_fijo')" name="cant_cuotas" readonly="state != 'draft'" required="periodicidad == 'periodico'"/>
                                <field invisible="periodicidad != 'periodico'" name="nro_cuota" readonly="True"/>
                                <field invisible="periodicidad == 'periodico' and tipo_cuota == 'porcentaje_sobre_bruto'" name="comentarios" readonly="state != 'draft'"/>
                                <field invisible="payslip_id == False" name="payslip_id" readonly="True"/>
                            </group>
                        </group>
                    </sheet>
                    <div class="oe_chatter">
                        <field name="message_follower_ids"/>
                        <field name="activity_ids"/>
                        <field name="message_ids"/>
                    </div>
                </form></field>
        </record>
        <record id="novedades_search_view" model="ir.ui.view">
            <field name="name">novedades_search_view</field>
            <field name="model">hr.novedades</field>
            <field name="arch" type="xml">
                <search>
                    <!--                    <field name="name" string="string" domain="[()]"/>-->
                    <field filter_domain="[('name','ilike',self)]" name="name"/>
                    <field filter_domain="[('contract_id','ilike',self)]" name="contract_id"/>
                    <field filter_domain="[('employee_id','ilike',self)]" name="employee_id"/>
                    <field filter_domain="[('tipo_id','ilike',self)]" name="tipo_id"/>
                    <field filter_domain="['|','|'('name','ilike',self),('contract_id','ilike',self),('employee_id','ilike',self)]" name="name"/>
                    <filter context="{'group_by': 'state'}" name="group_by_state" string="Estado"/>
                    <filter context="{'group_by': 'employee_id'}" name="group_by_employee_id" string="Empleado"/>
                    <filter context="{'group_by': 'tipo_id'}" name="group_by_tipo_id" string="Tipo de Novedad"/>
                </search></field>
        </record>
        <record id="novedades_act_window" model="ir.actions.act_window">
            <field name="name">Novedades</field>
            <field name="type">ir.actions.act_window</field>
            <field name="res_model">hr.novedades</field>
            <field name="view_mode">tree,form</field>
        </record>
        <record id="action_cancelar_novedades" model="ir.actions.server">
            <field name="name">Cancelar</field>
            <field name="binding_model_id" ref="rrhh_novedades.model_hr_novedades"/>
            <field name="model_id" ref="rrhh_novedades.model_hr_novedades"/>
            <field name="state">code</field>
            <field name="code">if records:
    records.button_cancelar()</field>
        </record>
        <record id="action_draft_novedades" model="ir.actions.server">
            <field name="name">Cambiar a borrador</field>
            <field name="binding_model_id" ref="rrhh_novedades.model_hr_novedades"/>
            <field name="model_id" ref="rrhh_novedades.model_hr_novedades"/>
            <field name="state">code</field>
            <field name="code">if records:
    records.button_draft()</field>
        </record>
        <menuitem id="rrhh_novedades.novedades_root" name="Novedades" parent="hr_payroll.menu_hr_payroll_payslips" sequence="90"/>
        <menuitem action="novedades_act_window" id="menu_novedades" name="Novedades" parent="rrhh_novedades.novedades_root" sequence="100"/>
        <menuitem action="novedades_act_window" id="menu_novedades_desembolso_account" name="Novedades - Desembolsos" parent="account.menu_finance_payables" sequence="100"/>
    </data>
    <!-- hr.novedades.desembolso_wizard -->
    <data>
        <record id="novedades_desembolso_wizard_form_view" model="ir.ui.view">
            <field name="name">novedades_desembolso_wizard_form_view</field>
            <field name="model">hr.novedades.desembolso_wizard</field>
            <field name="arch" type="xml">
                <form>
                    <group>
                        <field name="novedades_ids" widget="many2many_tags"/>
                        <field name="account_journal_id"/>
                        <field name="confirm_payment"/>
                    </group>
                    <footer>
                        <button class="oe_highlight" name="button_create_account_payment" string="Crear Pagos" type="object"/>
                        <button special="cancel" string="Cancelar"/>
                    </footer>
                </form></field>
        </record>
        <record id="novedades_desembolso_wizard_action_window" model="ir.actions.act_window">
            <field name="name">Crear Pagos</field>
            <field name="res_model">hr.novedades.desembolso_wizard</field>
            <field name="view_mode">form</field>
            <field name="target">new</field>
        </record>
    </data>
</odoo>
