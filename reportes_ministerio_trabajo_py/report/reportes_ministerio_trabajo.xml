<?xml version="1.0" encoding="UTF-8" ?>
<odoo>
    <data>
        <template id="reportes_ministerio_trabajo_py.empleados_y_obreros_zip_t">
            <t t-foreach="docs" t-as="doc">
                <t t-call="web.basic_layout">
                    <div class="page">
                        <t t-set="contracts" t-value="
doc.env['hr.contract.active_history'].search([
    ('contract_id', '!=', False),
    ('contract_id.employee_id', '!=', False),
    ('contract_id.company_id', '=', doc.company_id.id),
    ('contract_id.patronal_mtess_id', '=', doc.patronal_mtess_id.id),
    ('contract_id.appears_in_mtess_reports','=',True),
]).filtered(lambda contract_active_history:
            contract_active_history.date_start &lt;= doc.report_date_end and
            (not contract_active_history.date_end or contract_active_history.date_end &gt;= doc.report_date_start)
).mapped('contract_id').filtered(lambda c: c.employee_id)
"/>
                        <t t-set="contracts" t-value="contracts.sorted(key = lambda x:(x.employee_id.name or ''))"/>
                        <style>
                            table.lineas td, table.lineas th{
                            border: 1px solid gray;
                            text-align:center;
                            font-size:11px;
                            padding:5px;
                            }
                            table.pie{
                            margin-top:100px;
                            margin-left:auto;
                            margin-right:auto;
                            }
                            table.pie td{
                            padding:10px;
                            border: 1px solid white;
                            }
                        </style>
                        <div class="header">
                            <style>
                                table.cabecera td, table.cabecera tr{
                                border: 1px solid white;
                                font-size:15px;
                                }
                            </style>
                            <table class="cabecera" style="width:100%;">
                                <tr>
                                    <td colspan="3" style="text-align:center;font-weight:bold;">
                                        EMPLEADOS Y OBREROS
                                    </td>
                                </tr>
                                <tr>
                                    <td colspan="2">
                                        EMPLEADOR:
                                        <!--                                    <span t-esc="doc.company_id.name"/>-->
                                        <!--                                    <span t-esc="(doc.company_id.nombre + ' ' +doc.company_id.apellido) if doc.company_id.nombre or doc.company_id.apellido else doc.company_id.name"/>-->
                                        <span t-esc="doc.company_id.name"/>
                                    </td>
                                    <td>
                                        N° PATRONAL MJT:
                                        <span t-esc="doc.patronal_mtess_id.number"/>
                                    </td>
                                </tr>
                                <tr>
                                    <td>
                                        RAZÓN SOCIAL:
                                        <!--                                    <span t-esc="(doc.company_id.nombre + ' ' +doc.company_id.apellido) if doc.company_id.nombre or doc.company_id.apellido else doc.company_id.name"/>-->
                                        <span t-esc="doc.company_id.name"/>
                                    </td>
                                    <td>
                                        AÑO:
                                        <span t-esc="doc.year"/>
                                    </td>
                                    <td>
                                        N° PATRONAL IPS:
                                        <span t-esc="', '.join(contracts.patronal_ips_id.mapped('number'))"/>
                                    </td>
                                </tr>
                                <tr>
                                    <td>
                                        ACTIVIDAD:
                                        <span t-esc="doc.company_id.patronal_mtess_actividad"/>
                                    </td>
                                    <td>
                                        MES:
                                        <span t-esc="doc.month"/>
                                    </td>

                                    <td>
                                        RUC:
                                        <span t-esc="doc.company_id.vat"/>
                                    </td>
                                </tr>
                                <tr>
                                    <td>
                                        DOMICILIO:
                                        <span t-esc="doc.company_id.city"/>
                                    </td>
                                    <td colspan="2" style="color:white;">
                                        ID:
                                        <span t-esc="doc.id"/>
                                    </td>

                                </tr>
                                <tr>
                                    <td>
                                        DEPARTAMENTO:
                                        <span t-esc="doc.company_id.state_id.name"/>
                                    </td>
                                </tr>
                            </table>
                        </div>
                        <table class="lineas" style="width:100%;margin-top:50px;">
                            <tr>
                                <th rowspan="2">#</th>
                                <th rowspan="2">Apellidos, Nombres (Orden Alfabético)</th>
                                <th rowspan="2">Domicilio</th>
                                <th rowspan="2">Nacionalidad</th>
                                <th rowspan="2">C.I. N°</th>
                                <th rowspan="2">Edad</th>
                                <th rowspan="2">N° de Hijos</th>
                                <th colspan="4">MENORES</th>
                                <th rowspan="2">Profesión</th>
                                <th rowspan="2">Cargo Desempeñado</th>
                                <th rowspan="2">Fecha de Entrada</th>
                                <th rowspan="2">Fecha de Salida</th>
                                <th rowspan="2">Motivo de Salida</th>
                                <th rowspan="2">Observaciones</th>
                            </tr>
                            <tr>
                                <th>Fecha de Nac.</th>
                                <th>Situación Escolar</th>
                                <th>Cert. Capac. Exp. en Fecha</th>
                                <th>Horario de Trabajo</th>
                            </tr>
                            <t t-set="c" t-value="0"/>
                            <t t-foreach="contracts" t-as="contract_id">
                                <t t-set="c" t-value="c+1"/>
                                <tr>
                                    <td>
                                        <span t-esc="c"/>
                                    </td>
                                    <td style="text-align:left;">
                                        <span t-esc="contract_id.employee_id.name"/>
                                    </td>
                                    <td style="text-align:left;">
                                        <t t-if="contract_id.employee_id.address_home_id and contract_id.employee_id.address_home_id.street">
                                            <t t-set="streets" t-value="[contract_id.employee_id.address_home_id.street]"/>
                                            <t t-if="contract_id.employee_id.address_home_id.street2" t-set="aux"
                                               t-value="streets.append(contract_id.employee_id.address_home_id.street2)"/>
                                            <span t-esc="', '.join(streets)"/>
                                        </t>
                                    </td>
                                    <td>
                                        <span t-esc="contract_id.employee_id.country_id.name"/>
                                    </td>
                                    <td>
                                        <span t-esc="contract_id.employee_id.identification_id"/>
                                    </td>
                                    <td>
                                        <span t-esc="contract_id.employee_id.edad"/>
                                    </td>
                                    <td>
                                        <span t-esc="contract_id.employee_id.underage_children_count"/>
                                    </td>
                                    <td>
                                        <!--                                        <span t-esc="contract_id.employee_id.birthday.strftime('%d/%m/%Y') if contract_id.employee_id.birthday else ''"/>-->
                                    </td>
                                    <td/>
                                    <td/>
                                    <td/>
                                    <td>
                                        <span t-esc="contract_id.employee_id.job_id.name or 'Empleado'"/>
                                    </td>
                                    <td>
                                        <span t-esc="contract_id.job_id.name or 'Empleado'"/>
                                    </td>
                                    <td>
                                        <span t-esc="contract_id.date_start.strftime('%d/%m/%Y')"/>
                                    </td>
                                    <td>
                                        <span t-esc="contract_id.date_end.strftime('%d/%m/%Y') if contract_id.date_end else ''"/>
                                    </td>
                                    <td>
                                        <!--                                        <span t-esc="('- '.join([(contract_id.employee_id.departure_reason_id.name or ''), (contract_id.employee_id.departure_description or '')])) if contract_id.date_end else ''"/>-->
                                        <span t-esc="(contract_id.employee_id.departure_reason_id.name or '') if contract_id.date_end else ''"/>
                                    </td>
                                    <td/>
                                </tr>
                            </t>
                        </table>
                        <table class="pie">
                            <tr>
                                <td>
                                    FIRMA:
                                </td>
                                <td>_ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _</td>
                                <td>
                                    Aclaración:
                                </td>
                                <td>_ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _</td>
                            </tr>
                        </table>
                    </div>
                </t>
            </t>
        </template>

        <template id="reportes_ministerio_trabajo_py.sueldos_y_jornales_zip_t">
            <t t-foreach="docs" t-as="doc">
                <t t-call="web.basic_layout">
                    <div class="page">
                        <t t-set="payslips_mes"
                           t-value="doc.env['hr.payslip'].search([
                                    ('state','in',['done','paid']),
                                    ('company_id','=',doc.company_id.id),
                                    ('contract_id.patronal_mtess_id', '=', doc.patronal_mtess_id.id),
                                    ('contract_id.appears_in_mtess_reports','=',True),
                               ]).filtered(lambda slip:slip.date_to.year == doc.year and slip.date_to.month == int(doc.month))"/>
                        <t t-set="contracts" t-value="payslips_mes.mapped('contract_id')"/>
                        <t t-set="contracts" t-value="contracts.sorted(key = lambda x:(x.employee_id.name or ''))"/>
                        <style>
                            table.lineas td, table.lineas th{
                            border: 1px solid gray;
                            text-align:center;
                            font-size:11px;
                            padding:5px;
                            }
                            table.pie{
                            margin-top:100px;
                            margin-left:auto;
                            margin-right:auto;
                            }
                            table.pie td{
                            padding:10px;
                            border: 1px solid white;
                            }
                        </style>
                        <div class="header">
                            <style>
                                table.cabecera td, table.cabecera tr{
                                border: 1px solid white;
                                font-size:15px;
                                }
                            </style>
                            <table class="cabecera" style="width:100%;">
                                <tr>
                                    <td colspan="3" style="text-align:center;font-weight:bold;">
                                        SUELDOS Y JORNALES
                                    </td>
                                </tr>

                                <tr>
                                    <td>
                                        EMPLEADOR:
                                        <!--                                    <span t-esc="(doc.company_id.nombre + ' ' +doc.company_id.apellido) if doc.company_id.nombre or doc.company_id.apellido else doc.company_id.name"/>-->
                                        <span t-esc="doc.company_id.name"/>

                                    </td>
                                    <td>
                                        AÑO:
                                        <span t-esc="doc.year"/>
                                    </td>
                                    <td>
                                        N° PATRONAL MJT:
                                        <span t-esc="doc.patronal_mtess_id.number"/>
                                    </td>
                                </tr>
                                <tr>
                                    <td>
                                        RAZÓN SOCIAL:
                                        <!--                                    <span t-esc="(doc.company_id.nombre + ' ' +doc.company_id.apellido) if doc.company_id.nombre or doc.company_id.apellido else doc.company_id.name"/>-->
                                        <span t-esc="doc.company_id.name"/>
                                    </td>
                                    <td>
                                        MES:
                                        <span t-esc="doc.month"/>
                                    </td>
                                    <td>
                                        N° PATRONAL IPS:
                                        <span t-esc="', '.join(contracts.patronal_ips_id.mapped('number'))"/>
                                    </td>
                                </tr>
                                <tr>
                                    <td>
                                        ACTIVIDAD:
                                        <span t-esc="doc.company_id.patronal_mtess_actividad"/>
                                    </td>
                                    <td style="color:white;">
                                        ID:
                                        <span t-esc="doc.id"/>
                                    </td>
                                    <td>
                                        RUC:
                                        <span t-esc="doc.company_id.vat"/>
                                    </td>
                                </tr>
                                <tr>
                                    <td colspan="2">
                                        DOMICILIO:
                                        <span t-esc="doc.company_id.city"/>
                                    </td>
                                    <td>
                                        TELÉFONO:
                                        <span t-esc="doc.company_id.phone"/>
                                    </td>
                                </tr>
                                <tr>
                                    <td colspan="2">
                                        DEPARTAMENTO:
                                        <span t-esc="doc.company_id.state_id.name"/>
                                    </td>
                                    <td>
                                        CORREO ELECTRÓNICO:
                                        <span t-esc="doc.company_id.email"/>
                                    </td>
                                </tr>
                                <tr>
                                    <td colspan="2">
                                        LOCALIDAD:
                                        <span t-esc="doc.company_id.state_id.name"/>
                                    </td>
                                    <td>
                                        SITIO WEB:
                                        <span t-esc="doc.company_id.website"/>
                                    </td>
                                </tr>
                            </table>
                        </div>
                        <table class="lineas" style="width:100%;margin-top:50px;">
                            <t t-set="total_importe_unitario" t-value="0"/>
                            <t t-set="total_importe_percibido" t-value="0"/>
                            <t t-set="total_horas_extra_50" t-value="0"/>
                            <t t-set="total_horas_extra_100" t-value="0"/>
                            <t t-set="total_horas_extra_valor" t-value="0"/>
                            <t t-set="total_salario_inc_horas_extra" t-value="0"/>
                            <t t-set="total_aguinaldo" t-value="0"/>
                            <t t-set="total_bonificacion_familiar" t-value="0"/>
                            <t t-set="total_vacaciones" t-value="0"/>
                            <t t-set="total_otros_beneficios" t-value="0"/>
                            <t t-set="total_general" t-value="0"/>
                            <tr>
                                <t t-set="total_colspan" t-value="3"/>
                                <th rowspan="2">#</th>
                                <th rowspan="2">NOMBRE Y APELLIDO</th>
                                <th rowspan="2">N° C.I.</th>
                                <t t-set="cantidad_dias_mes" t-value="doc.get_monthrange(doc.year,int(doc.month))"/>
                                <t t-set="total_colspan" t-value="total_colspan + cantidad_dias_mes"/>
                                <t t-foreach="range(1,cantidad_dias_mes+1)" t-as="dia">
                                    <th rowspan="2">
                                        <t t-esc="dia"/>
                                    </th>
                                </t>
                                <t t-set="total_colspan" t-value="total_colspan + 1"/>
                                <th rowspan="1" colspan="5">SALARIO TOTAL</th>
                                <th rowspan="1" colspan="3">HORAS EXTRAS</th>
                                <th rowspan="2">TOTAL SALARIO INCL. H. EXT.</th>
                                <th rowspan="1" colspan="4">BENEFICIOS SOCIALES</th>
                                <th rowspan="2">TOTAL GRAL. INCL. H. EXT. Y BENF. SOC.</th>
                            </tr>
                            <tr>
                                <th>Forma de pago</th>
                                <th>Importe unitario</th>
                                <th>Dias de trabajo</th>
                                <th>Horas de trabajo</th>
                                <th>Importe Percibido</th>
                                <th>50%</th>
                                <th>100%</th>
                                <th>Valor</th>
                                <th>Aguinaldo</th>
                                <th>Bonif. Fam.</th>
                                <th>Vacac.</th>
                                <th>Otros Benef.</th>
                            </tr>
                            <t t-set="c" t-value="1"/>
                            <t t-foreach="contracts" t-as="contract">
                                <t t-set="payslips_contrato" t-value="payslips_mes.filtered(lambda p:p.contract_id == contract)"/>
                                <t t-set="cantidad_horas" t-value="0"/>
                                <t t-set="cantidad_dias" t-value="0"/>
                                <t t-set="cantidad_dias_a_mostrar" t-value="0"/>
                                <t t-set="total_linea" t-value="0"/>
                                <tr>
                                    <td>
                                        <t t-esc="c"/>
                                        <t t-set="c" t-value="c+1"/>
                                    </td>
                                    <td>
                                        <t t-esc="contract.employee_id.name"/>
                                    </td>
                                    <td>
                                        <t t-esc="contract.employee_id.identification_id"/>
                                    </td>
                                    <t t-foreach="range(1,doc.get_monthrange(doc.year,int(doc.month))+1)" t-as="dia">
                                        <td>
                                            <t t-set="comprobar_dia_result" t-value="doc.comprobar_dia(dia,contract)"/>
                                            <t t-esc="comprobar_dia_result"/>
                                            <t t-set="cantidad_horas"
                                               t-value="cantidad_horas + (comprobar_dia_result if isinstance(comprobar_dia_result,int) else 0)"/>
                                            <t t-set="cantidad_dias"
                                               t-value="cantidad_dias + (1 if (isinstance(comprobar_dia_result,int) or comprobar_dia_result in ['D','F']) else 0)"/>
                                            <t t-set="cantidad_dias_a_mostrar"
                                               t-value="cantidad_dias_a_mostrar + (1 if (isinstance(comprobar_dia_result,int) and comprobar_dia_result not in [0]) else 0)"/>
                                        </td>
                                    </t>
                                    <t t-set="total_net" t-value="contract.get_computed_daily_wage(doc.report_date_end)*30"/>
                                    <t t-set="importe_unitario" t-value="total_net/30"/>
                                    <t t-set="vacacion"
                                       t-value="sum(doc.env['hr.payslip'].search([('contract_id','=',contract.id),('state','in',['done','paid']),('contract_id.company_id','=',doc.company_id.id),('struct_id.type_id.structure_type_tag','=','vacacion')]).filtered(lambda slip:slip.date_from.year == doc.year and slip.date_from.month == int(doc.month)).mapped('line_ids').filtered(lambda x:x.code in ['GROSS']).mapped('total'))"/>
                                    <t t-set="total_net" t-value="total_net - vacacion"/>
                                    <td>
                                        <t t-esc="({'monthly':'Mensual','daily':'Jornal','hourly':'Por Hora'}).get(contract.wage_type)"/>
                                    </td>
                                    <td>
                                        <t t-set="total_importe_unitario" t-value="total_importe_unitario + round(importe_unitario)"/>
                                        <t t-esc="'{0:,}'.format(round(importe_unitario)).replace(',', '.')"/>
                                    </td>
                                    <td>
                                        <!--                                        <t t-esc="cantidad_dias"/>-->
                                        <t t-esc="cantidad_dias_a_mostrar"/>
                                    </td>
                                    <td>
                                        <t t-esc="cantidad_horas"/>
                                    </td>
                                    <td>
                                        <t t-set="total_importe_percibido" t-value="total_importe_percibido + round(total_net)"/>
                                        <t t-esc="'{0:,}'.format(round(total_net)).replace(',', '.')"/>
                                    </td>

                                    <td>
                                        <t t-set="total_hex50_qty" t-value="
sum(payslips_contrato.mapped('line_ids').filtered(
    lambda line: line.code in (doc.company_id.sueldos_y_jornales_report_codigos_hex_50 or '').split(',')
).mapped('quantity'))"/>
                                        <t t-set="total_hex50" t-value="
sum(payslips_contrato.mapped('line_ids').filtered(
    lambda line: line.code in (doc.company_id.sueldos_y_jornales_report_codigos_hex_50 or '').split(',')
).mapped('total'))"/>
                                        <t t-set="total_horas_extra_50" t-value="total_horas_extra_50 + total_hex50_qty"/>
                                        <t t-esc="'{0:,}'.format(total_hex50_qty).replace(',', '.') if total_hex50_qty else 0"/>
                                    </td>
                                    <td>
                                        <t t-set="total_hex100_qty" t-value="
sum(payslips_contrato.mapped('line_ids').filtered(
    lambda line: line.code in (doc.company_id.sueldos_y_jornales_report_codigos_hex_100 or '').split(',')
).mapped('quantity'))"/>
                                        <t t-set="total_hex100" t-value="
sum(payslips_contrato.mapped('line_ids').filtered(
    lambda line: line.code in (doc.company_id.sueldos_y_jornales_report_codigos_hex_100 or '').split(',')
).mapped('total'))"/>
                                        <t t-set="total_horas_extra_100" t-value="total_horas_extra_100 + total_hex100_qty"/>
                                        <t t-esc="'{0:,}'.format(total_hex100_qty).replace(',', '.') if total_hex100_qty else 0"/>
                                    </td>
                                    <td>
                                        <t t-set="total_horas_extra_valor" t-value="total_horas_extra_valor + round(total_hex50 + total_hex100)"/>
                                        <t t-esc="'{0:,}'.format(round(total_hex50 + total_hex100)).replace(',', '.')"/>
                                    </td>
                                    <!--                                    <t t-set="total_net" t-value="total_net + total_hex50 + total_hex100 + total_hex_other"/>-->
                                    <t t-set="total_net" t-value="total_net + total_hex50 + total_hex100"/>
                                    <td>
                                        <!--                                        <t t-set="total_net" t-value="sum(payslips_contrato.mapped('net_wage'))"/>-->
                                        <t t-set="total_salario_inc_horas_extra" t-value="total_salario_inc_horas_extra + round(total_net)"/>
                                        <t t-esc="'{0:,}'.format(round(total_net)).replace(',', '.')"/>
                                    </td>
                                    <td>
                                        <t t-set="aguinaldo" t-value="sum(doc.env['hr.payslip'].search([
                                            ('contract_id','=',contract.id),
                                            ('state','in',['done','paid']),
                                            ('company_id','=',doc.company_id.id),
                                            ('struct_id.type_id.structure_type_tag','=','aguinaldo')
                                        ]).filtered(lambda slip:slip.date_to.year == doc.year and slip.date_to.month == int(doc.month)).mapped('net_wage'))"/>
                                        <t t-set="aguinaldo" t-value="aguinaldo + sum(doc.env['hr.payslip'].search([
                                            ('contract_id','=',contract.id),
                                            ('state','in',['done','paid']),
                                            ('company_id','=',doc.company_id.id),
                                            ('struct_id.type_id.structure_type_tag','=','liquidacion')
                                        ]).filtered(lambda slip:
                                            slip.date_to.year == doc.year and
                                            slip.date_to.month == int(doc.month)
                                        ).mapped('line_ids').filtered(lambda line: line.code in ['AGUIPR']).mapped('total'))"/>
                                        <t t-set="total_aguinaldo" t-value="total_aguinaldo + round(aguinaldo)"/>
                                        <t t-esc="'{0:,}'.format(round(aguinaldo)).replace(',', '.')"/>
                                    </td>
                                    <td>
                                        <t t-set="salario_bonificacion_familiar" t-value="
sum(payslips_contrato.mapped('line_ids').filtered(
    lambda line: line.code in (doc.company_id.sueldos_y_jornales_report_codigos_bonificacion_familiar or '').split(',')
).mapped('total'))"/>
                                        <t t-set="total_bonificacion_familiar" t-value="total_bonificacion_familiar + round(salario_bonificacion_familiar)"/>
                                        <t t-esc="'{0:,}'.format(round(salario_bonificacion_familiar)).replace(',', '.')"/>
                                    </td>
                                    <td>
                                        <t t-set="total_vacaciones" t-value="total_vacaciones + round(vacacion)"/>
                                        <t t-esc="'{0:,}'.format(round(vacacion)).replace(',', '.')"/>
                                    </td>
                                    <td>
                                        <t t-set="salario_beneficios_liquidaciones" t-value="
sum(payslips_contrato.mapped('line_ids').filtered(
    lambda line: line.code in (doc.company_id.sueldos_y_jornales_report_codigos_otros_beneficios or '').split(',') and line.code not in ['AGUIPR']
).mapped('total'))"/>
                                        <t t-set="total_otros_beneficios" t-value="total_otros_beneficios + round(salario_beneficios_liquidaciones)"/>
                                        <t t-esc="'{0:,}'.format(round(salario_beneficios_liquidaciones)).replace(',', '.')"/>
                                    </td>
                                    <td>

                                        <t t-set="total_salario"
                                           t-value="round(total_net+aguinaldo+salario_bonificacion_familiar+vacacion+salario_beneficios_liquidaciones)"/>
                                        <t t-set="total_general" t-value="total_general + total_salario"/>
                                        <t t-esc="'{0:,}'.format(total_salario).replace(',', '.')"/>
                                    </td>
                                </tr>
                            </t>
                            <tr style="font-weight:bold;">
                                <td t-att-colspan="total_colspan">Totales</td>
                                <td t-esc="'{0:,}'.format(total_importe_unitario).replace(',', '.')"/>
                                <td/>
                                <td/>
                                <td t-esc="'{0:,}'.format(total_importe_percibido).replace(',', '.')"/>
                                <td t-esc="'{0:,}'.format(total_horas_extra_50).replace(',', '.')"/>
                                <td t-esc="'{0:,}'.format(total_horas_extra_100).replace(',', '.')"/>
                                <td t-esc="'{0:,}'.format(total_horas_extra_valor).replace(',', '.')"/>
                                <td t-esc="'{0:,}'.format(total_salario_inc_horas_extra).replace(',', '.')"/>
                                <td t-esc="'{0:,}'.format(total_aguinaldo).replace(',', '.')"/>
                                <td t-esc="'{0:,}'.format(total_bonificacion_familiar).replace(',', '.')"/>
                                <td t-esc="'{0:,}'.format(total_vacaciones).replace(',', '.')"/>
                                <td t-esc="'{0:,}'.format(total_otros_beneficios).replace(',', '.')"/>
                                <td t-esc="'{0:,}'.format(total_general).replace(',', '.')"/>
                            </tr>
                        </table>
                        <table class="pie">
                            <tr>
                                <td>
                                    FIRMA:
                                </td>
                                <td>_ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _</td>
                                <td>
                                    Aclaración:
                                </td>
                                <td>_ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _</td>
                            </tr>
                        </table>
                    </div>
                </t>
            </t>
        </template>

        <template id="reportes_ministerio_trabajo_py.vacaciones_zip_t">
            <t t-foreach="docs" t-as="doc">
                <t t-call="web.basic_layout">
                    <div class="page">
                        <t t-set="notificaciones_vacaciones"
                           t-value="doc.env['notificacion.vacacion'].search([
                                    ('state','=','done'),
                                    ('company_id','=',doc.company_id.id),
                                    ('contract_id.patronal_mtess_id', '=', doc.patronal_mtess_id.id),
                                    ('contract_id.appears_in_mtess_reports','=',True),
                               ]).filtered(lambda notificacion:notificacion.fecha_inicio_vacaciones.year == doc.year)"/>
                        <t t-set="notificaciones_vacaciones"
                           t-value="notificaciones_vacaciones.sorted(key = lambda x:(x.contract_id.employee_id.name or ''))"/>
                        <style>
                            table.lineas td, table.lineas th{
                            border: 1px solid gray;
                            text-align:center;
                            font-size:11px;
                            padding:5px;
                            }
                            table.pie{
                            margin-top:100px;
                            margin-left:auto;
                            margin-right:auto;
                            }
                            table.pie td{
                            padding:10px;
                            border: 1px solid white;
                            }
                        </style>
                        <div class="header">
                            <style>
                                table.cabecera td, table.cabecera tr{
                                border: 1px solid white;
                                font-size:15px;
                                }
                            </style>
                            <table class="cabecera" style="width:100%;">
                                <tr>
                                    <td colspan="3" style="text-align:center;font-weight:bold;">
                                        VACACIONES
                                    </td>
                                </tr>
                                <tr>
                                    <td>
                                        EMPLEADOR:
                                        <!--                                    <span t-esc="(doc.company_id.nombre + ' ' +doc.company_id.apellido) if doc.company_id.nombre or doc.company_id.apellido else doc.company_id.name"/>-->
                                        <span t-esc="doc.company_id.name"/>
                                    </td>
                                    <td>
                                        AÑO:
                                        <span t-esc="doc.year"/>
                                    </td>
                                    <td>
                                        N° PATRONAL MJT:
                                        <span t-esc="doc.patronal_mtess_id.number"/>
                                    </td>
                                </tr>
                                <tr>
                                    <td>
                                        RAZÓN SOCIAL:
                                        <!--                                    <span t-esc="(doc.company_id.nombre + ' ' +doc.company_id.apellido) if doc.company_id.nombre or doc.company_id.apellido else doc.company_id.name"/>-->
                                        <span t-esc="doc.company_id.name"/>
                                    </td>
                                    <td>
                                        MES:
                                        <span t-esc="12"/>
                                    </td>
                                    <td>
                                        N° PATRONAL IPS:
                                        <span t-esc="', '.join(notificaciones_vacaciones.contract_id.patronal_ips_id.mapped('number'))"/>
                                    </td>
                                </tr>
                                <tr>
                                    <td colspan="2">
                                        ACTIVIDAD:
                                        <span t-esc="doc.company_id.patronal_mtess_actividad"/>
                                    </td>
                                    <td>
                                        RUC:
                                        <span t-esc="doc.company_id.vat"/>
                                    </td>
                                </tr>
                                <tr>
                                    <td colspan="2">
                                        DOMICILIO:
                                        <span t-esc="doc.company_id.city"/>
                                    </td>
                                    <td>
                                        TELÉFONO:
                                        <span t-esc="doc.company_id.phone"/>
                                    </td>
                                </tr>
                                <tr>
                                    <td colspan="2">
                                        DEPARTAMENTO:
                                        <span t-esc="doc.company_id.state_id.name"/>
                                    </td>
                                    <td>
                                        CORREO ELECTRÓNICO:
                                        <span t-esc="doc.company_id.email"/>
                                    </td>
                                </tr>
                                <tr>
                                    <td colspan="2">
                                        LOCALIDAD:
                                        <span t-esc="doc.company_id.state_id.name"/>
                                    </td>
                                    <td>
                                        SITIO WEB:
                                        <span t-esc="doc.company_id.website"/>
                                    </td>
                                </tr>
                            </table>
                        </div>
                        <table class="lineas" style="width:100%;margin-top:50px;">
                            <tr>
                                <th rowspan="2">#</th>
                                <th rowspan="2">NOMBRE Y APELLIDO</th>
                                <th rowspan="2">FECHA DE INGRESO</th>
                                <th rowspan="1" colspan="3">DURACION DE VACACIONES</th>
                                <th rowspan="2">REMUNERACION</th>
                                <th rowspan="2">OBSERVACIONES</th>
                            </tr>
                            <tr>
                                <th>DIAS</th>
                                <th>DESDE</th>
                                <th>HASTA</th>
                            </tr>
                            <t t-set="c" t-value="1"/>
                            <t t-foreach="notificaciones_vacaciones" t-as="notificacion">
                                <tr>
                                    <td>
                                        <span t-esc="c"/>
                                        <t t-set="c" t-value="c+1"/>
                                    </td>
                                    <td style="text-align:left;">
                                        <span t-esc="notificacion.employee_id.name"/>
                                    </td>
                                    <td>
                                        <span t-esc="notificacion.contract_id.date_start.strftime('%d/%m/%Y')"/>
                                    </td>
                                    <td>
                                        <span t-esc="notificacion.dias_vacaciones"/>
                                    </td>
                                    <td>
                                        <span t-esc="notificacion.fecha_inicio_vacaciones.strftime('%d/%m/%Y')"/>
                                    </td>
                                    <td>
                                        <span t-esc="notificacion.fecha_fin_vacaciones.strftime('%d/%m/%Y')"/>
                                    </td>
                                    <td style="text-align:right;">
                                        <span t-esc="'{0:,}'.format(round(notificacion.payslip_id.gross_wage)).replace(',', '.')"/>
                                    </td>
                                    <td/>
                                </tr>
                            </t>
                            <tr>
                                <td colspan="6">Total</td>
                                <td style="text-align:right;">
                                    <span t-esc="'{0:,}'.format(round(sum(notificaciones_vacaciones.payslip_id.mapped('gross_wage')))).replace(',', '.')"/>
                                </td>
                                <td/>
                            </tr>
                        </table>
                        <table class="pie">
                            <tr>
                                <td>
                                    FIRMA:
                                </td>
                                <td>_ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _</td>
                                <td>
                                    Aclaración:
                                </td>
                                <td>_ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _</td>
                            </tr>
                        </table>
                    </div>
                </t>
            </t>
        </template>

        <record model="report.paperformat" id="papel_rubricas_ministerio_trabajo">
            <field name="name">Rubrica</field>
            <field name="format">A4</field>
            <field name="orientation">Landscape</field>
            <field name="margin_top">70</field>
            <field name="margin_left">5</field>
            <field name="margin_right">5</field>
            <field name="margin_bottom">5</field>
            <field name="header_line" eval="False"/>
            <field name="header_spacing">40</field>
            <field name="dpi">90</field>
        </record>

        <record model="ir.actions.report" id="reportes_ministerio_trabajo_py.empleados_y_obreros_zip">
            <field name="name">Empleados y Obreros</field>
            <field name="model">empleados_y_obreros_zip_model</field>
            <field name="report_type">qweb-pdf</field>
            <field name="report_name">reportes_ministerio_trabajo_py.empleados_y_obreros_zip_t</field>
            <field name="print_report_name">"Empleados y Obreros - %s - %s - %s" % (object.company_id.name,object.year,object.month)</field>
            <field name="paperformat_id" ref="papel_rubricas_ministerio_trabajo"/>
            <field name="binding_model_id" ref="model_empleados_y_obreros_zip_model"/>
            <field name="binding_type">report</field>
        </record>
        <record model="ir.actions.report" id="reportes_ministerio_trabajo_py.sueldos_y_jornales_zip">
            <field name="name">Sueldos y Jornales</field>
            <field name="model">sueldos_y_jornales_zip_model</field>
            <field name="report_type">qweb-pdf</field>
            <field name="report_name">reportes_ministerio_trabajo_py.sueldos_y_jornales_zip_t</field>
            <field name="print_report_name">"Sueldos y Jornales - %s - %s - %s" % (object.company_id.name,object.year,object.month)</field>
            <field name="paperformat_id" ref="papel_rubricas_ministerio_trabajo"/>
            <field name="binding_model_id" ref="model_sueldos_y_jornales_zip_model"/>
            <field name="binding_type">report</field>
        </record>
        <record model="ir.actions.report" id="reportes_ministerio_trabajo_py.vacaciones_zip">
            <field name="name">Vacaciones</field>
            <field name="model">vacaciones_zip_model</field>
            <field name="report_type">qweb-pdf</field>
            <field name="report_name">reportes_ministerio_trabajo_py.vacaciones_zip_t</field>
            <field name="print_report_name">"Vacaciones - %s - %s" % (object.company_id.name,object.year)</field>
            <field name="paperformat_id" ref="papel_rubricas_ministerio_trabajo"/>
            <field name="binding_model_id" ref="model_vacaciones_zip_model"/>
            <field name="binding_type">report</field>
        </record>

    </data>
</odoo>
